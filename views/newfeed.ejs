<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trang thông báo</title>
    <!--navbar-->
    <link rel="stylesheet" type="text/css" href="stylesheet/style.css">
    <link rel="icon" type="image/png" href="https://iconarchive.com/download/i85627/graphicloads/100-flat/student.ico">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" integrity="sha512-iBBXm8fW90+nuLcSKlbmrPcLa0OT92xO1BIsZ+ywDWZCvqsWgccV3gFoRBv0z+8dLJgyAHIhR35VZc2oM/gI1w==" crossorigin="anonymous" />
    <link href="http://www.jqueryscript.net/demo/jQuery-Plugin-For-Multi-Select-List-with-Checkboxes-MultiSelect/jquery.multiselect.css" rel="stylesheet" type="text/css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.js" integrity="sha512-n/4gHW3atM3QqRcbCn6ewmpxcLAHGaDjpEBu4xZd47N0W2oQ+6q7oc3PXstrJYXcbNU1OHdQ1T7pAP+gi5Yu8g==" crossorigin="anonymous"></script>    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    <script src="http://www.jqueryscript.net/demo/jQuery-Plugin-For-Multi-Select-List-with-Checkboxes-MultiSelect/jquery.multiselect.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js" integrity="sha512-q/dWJ3kcmjBLU4Qc47E4A9kTB4m3wuTY7vkFJDTZKjTs8jhyGQnaUrxa0Ytd0ssMZhbNua9hE+E7Qv1j+DyZwA==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/notify/0.4.2/notify.min.js" integrity="sha512-efUTj3HdSPwWJ9gjfGR71X9cvsrthIA78/Fvd/IN+fttQVy7XWkOAXb295j8B3cmm/kFKVxjiNYzKw9IQJHIuQ==" crossorigin="anonymous"></script>
    <script src="https://cdn.datatables.net/1.10.24/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.24/js/dataTables.bootstrap4.min.js"></script>
    <script src="https://cdn.datatables.net/responsive/2.2.7/js/dataTables.responsive.min.js"></script>
    <script src="https://cdn.datatables.net/responsive/2.2.7/js/responsive.bootstrap4.min.js"></script>
    <script src="https://cdn.tiny.cloud/1/0g36mi4jlbxfg71otms4xaugdcjo8mdfzkr3yz35jsvwzwai/tinymce/5/tinymce.min.js" referrerpolicy="origin"></script>

    <!---->

</head>
<body>






        <nav class="navbar navbar-expand-lg navbar-light bg-light">
              <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavDropdown" aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
              </button>
              <div class="collapse navbar-collapse" id="navbarNavDropdown">
                <ul class="navbar-nav">
                  <li class="nav-item">
                    <a class="nav-link active" aria-current="page" href="/newfeed">Trang chủ &nbsp;&nbsp;</a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link active" aria-current="page" href="/newfeed/allNotif">Thông báo &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;</a>
                  </li>




                  <li class="nav-item dropdown active" style="float: right;">
                    <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownMenuLink" role="button" data-toggle="dropdown" aria-expanded="false">
                      <img class="rounded mr-3" id="userImg" src="<%= user.avatar %> " width="40"><%= user.name %>
                    </a>
                    <ul class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
                        <li><a class="dropdown-item" href="#" data-toggle="modal" data-target="#edit" >Chỉnh sửa thông tin</a></li>
                      <div class="dropdown-divider"></div>
                      <li><a class="dropdown-item" href="/login/logout">Đăng xuất  <i class="fas fa-sign-out-alt" style="color: brown;"></i></a></li>
                      <% if (user.role == 'admin') {%> 
                        <div class="dropdown-divider"></div>
                        <li><a class="dropdown-item" href="/login/register">Tạo tài khoản</a></li>
                      <% } %> 
                    </ul>
                  </li>
                  



                </ul>
              </div>
          </nav>
    <!-- Modal -->
    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" style="text-align: center; font-weight: bold; font-size: 30px;">Tạo bài viết</h5>
            </div>
            <div class="modal-body">
                <form>
                    <textarea name="postcontent" id="postcontent" style="border-radius: initial;border: none;outline: none;" class="form-control input-lg p-text-area tiny" rows="2" placeholder="Whats in your mind today?" required></textarea>
                    <div class="modal-footer">
                      <button type="button" id="postNewfeed" data-dismiss="modal" class="btn btn-primary">Đăng bài viết</button>
                      <button type="button" class="btn btn-secondary" data-dismiss="modal">Hủy</button>
                    </div>
                </form>
            </div>
            
          </div>
        </div>
      </div>
    <!-- Modal -->
    <!-- Khoa Modal -->
<div class="modal fade bd-example-modal-lg" id="khoa" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog modal-lg" role="document">
      <div class="modal-content">
        <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel">Chọn phòng khoa</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <form>
              <div class="form-group">
                <label for="recipient-name" class="col-form-label">Tiêu đề:</label>
                <input name="title" id="NotifTitle" type="text" class="form-control" required>
              </div>

              <div class="form-group">
                <label for="recipient-name" class="col-form-label">Nội dung:</label>
                <input id="NotifContent" name="content" type="text" class="form-control" required>
              </div>

             
              <div class="form-group">
                <h5>Danh sách khoa:</h5>
                <select id="falcuty" name="falcuty" class="form-control" required>
                  <% if(user.falcuty.includes('KHOA HỌC THỂ THAO')) { %> 
                  <option value="KHOA HỌC THỂ THAO">Khoa học thể thao</option>
                  <% } %>
                  <% if(user.falcuty.includes('KHOA HỌC ỨNG DỤNG')) { %> 
                    <option value="KHOA HỌC ỨNG DỤNG">Khoa học ứng dụng</option>
                  <% } %>
                  <% if(user.falcuty.includes('KHOA HỌC XÃ HỘI VÀ NHÂN VĂN')) { %> 
                    <option value="KHOA HỌC XÃ HỘI VÀ NHÂN VĂN">Khoa học xã hội & nhân văn</option>
                  <% } %>
                  <% if(user.falcuty.includes('CÔNG NGHỆ THÔNG TIN')) { %> 
                    <option value="CÔNG NGHỆ THÔNG TIN">Công nghệ thông tin</option>
                  <% } %>
                  <% if(user.falcuty.includes('ĐIỆN - ĐIỆN TỬ')) { %> 
                    <option value="ĐIỆN - ĐIỆN TỬ">Điện - Điện tử</option>
                  <% } %>
                  <% if(user.falcuty.includes('TOÁN - THỐNG KÊ')) { %> 
                    <option value="TOÁN - THỐNG KÊ">Toán - Thống kê</option>
                  <% } %>
                  <% if(user.falcuty.includes('MỸ THUẬT CÔNG NGHIỆP')) { %> 
                    <option value="MỸ THUẬT CÔNG NGHIỆP">Mỹ thuật công nghiệp</option>
                  <% } %>
                  <% if(user.falcuty.includes('KỸ THUẬT CÔNG TRÌNH')) { %> 
                    <option value="KỸ THUẬT CÔNG TRÌNH">Kỹ thuật công trình</option>
                  <% } %>
                  <% if(user.falcuty.includes('DƯỢC')) { %> 
                    <option value="DƯỢC">Dược</option>
                  <% } %>
                  <% if(user.falcuty.includes('LUẬT')) { %> 
                    <option value="LUẬT">Luật</option>
                  <% } %>
                  <% if(user.falcuty.includes('NGOẠI NGỮ')) { %> 
                    <option value="NGOẠI NGỮ">Ngoại ngữ</option>
                  <% } %>
                  <% if(user.falcuty.includes('QUẢN TRỊ KINH DOANH')) { %> 
                    <option value="QUẢN TRỊ KINH DOANH">Quản trị kinh doanh</option>
                  <% } %>
                  <% if(user.falcuty.includes('KẾ TOÁN')) { %> 
                    <option value="KẾ TOÁN">Kế toán</option>
                  <% } %>
                  <% if(user.falcuty.includes('TÀI CHÍNH NGÂN HÀNG')) { %> 
                    <option value="TÀI CHÍNH NGÂN HÀNG">Tài chính ngân hàng</option>
                  <% } %>
                  <% if(user.falcuty.includes('MÔI TRƯỜNG VÀ BẢO HỘ LAO ĐỘNG')) { %> 
                    <option value="MÔI TRƯỜNG VÀ BẢO HỘ LAO ĐỘNG">Môi trường và bảo hộ lao động</option>
                  <% } %>
                  <% if(user.falcuty.includes('LAO ĐỘNG VÀ CÔNG ĐOÀN')) { %> 
                    <option value="LAO ĐỘNG VÀ CÔNG ĐOÀN">Lao động và công đoàn</option>
                  <% } %>
                  <% if(user.falcuty.includes('PHÒNG CTHSSV')) { %> 
                    <option value="PHÒNG CTHSSV">Phòng CTHSSV</option>
                  <% } %>
                  <% if(user.falcuty.includes('PHÒNG TÀI CHÍNH')) { %> 
                    <option value="PHÒNG TÀI CHÍNH">Phòng Tài Chính</option>
                  <% } %>
                  <% if(user.falcuty.includes('PHÒNG ĐẠI HỌC')) { %> 
                    <option value="PHÒNG ĐẠI HỌC">Phòng Đại Học</option>
                  <% } %>
                </select>
              </div>
              <div class="modal-footer">
                <button type="button" data-dismiss="modal" id="sendNotif" onclick="sendMessage()" class="btn btn-primary">Lưu</button>
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Hủy</button>
              </div>
            </form>
          </div>
      </div>
    </div>
</div>

<div class="modal fade bd-example-modal-lg" id="edit" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog modal-lg" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <% if(user.role == 'student') { %> 
            <h5 class="modal-title" id="exampleModalLabel">Cập nhật thông tin</h5>
          <% } else { %>
            <h5 class="modal-title" id="exampleModalLabel">Thay đổi mật khẩu</h5>
          <% } %>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <form>
              <% if(user.role == 'student') { %> 
              <div class="form-group">
                <label for="recipient-name" class="col-form-label">Tên hiển thị:</label>
                <input type="text" class="form-control" value="<%= user.name %> " id="name" required>
              </div>

              <div class="form-group">
                <label for="recipient-name" class="col-form-label">Lớp:</label>
                <input type="text" class="form-control" value="<%= user.class %> " id="class" required>
              </div>

              <div class="form-group">
                <label for="recipient-name" class="col-form-label">Khoa:</label>
                <input type="text" class="form-control" value="<%= user.falcuty %> " id="falcuty" required>
              </div>

              <div class="form-group">
                <label for="recipient-name" class="col-form-label">Ảnh đại diện:</label>
                <input type="text" class="form-control" value="<%= user.avatar %> " id="avatar" required>
              </div>
              <% } else { %>
                <div class="form-group">
                  <label for="recipient-name" class="col-form-label">Nhập mật khẩu cũ:</label>
                  <input type="text" class="form-control" name="password" id="password" required>
                </div>
  
                <div class="form-group">
                  <label for="recipient-name" class="col-form-label">Nhập mật khẩu mới</label>
                  <input type="password" class="form-control" name="newpassword" id="newpassword" required>
                </div>
              <% } %>
            </form>
          </div>
          <div class="modal-footer">
            <% if(user.role == 'student') { %> 
            <button type="button" id="updateAccount" data-id="<%= user._id %>" data-dismiss="modal" class="btn btn-primary">Lưu</button>
            <% } else { %>
              <button type="button" id="updatePassword" data-id="<%= user._id %>" data-dismiss="modal" class="btn btn-primary">Lưu</button>
            <% } %>
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Hủy</button>
          </div>
      </div>
    </div>
</div>
<!-- End Edit Modal -->
   
    <div class="container-fluid">
      <div class="row">
        <div class="col-sm-9 col-md-6 col-lg-8 p-3">
          <% if(user.role == 'student') { %> 
                  <button type="button" data-toggle="modal" data-target="#myModal" class="btn btn-sm btn-info ">
                    <span aria-hidden="true"> <i class="fas fa-plus fa-sm"></i> Tạo bài viết&nbsp;&nbsp;</span>
                  </button>
                  <% } else { %> 
                  <button type="button" data-toggle="modal" data-target="#khoa" class="btn btn-sm btn-info " >
                    <span aria-hidden="true"> <i class="fas fa-plus fa-sm"></i> Tạo thông báo&nbsp;&nbsp;</span>
                  </button>
                  <% } %>   
        </div>
    </div>
      <div class="row">
        <div class="col p-3">
        </div>
      </div>

      <!--Socket-->
        <div class="row" id="popupdiv" hidden>
            <div class="col-sm-9 col-md-6 col-lg-8 p-3">
            </div>
        </div>
        <div class="row">
            <div class="col-sm-9 col-md-6 col-lg-8 p-3" id="postList">
              <div class="card mt-3 bg-light" id="<%= post._id %>">
                <div class="card-body maintext slide-right" >
              <h5 class="card-title welcome"><b class="text-primary">Các bài đăng gần đây</b> </h5>
            </div>
              </div>
            
                
                <% if (posts) { posts = posts.reverse(); posts.forEach((post, index) => { %>
                <div class="card mt-3 bg-light" id="<%= post._id %>">
                  <% if(user.name == post.Owner || user.role == 'admin') { %>
                  <!--Dropdown edit, delete-->
                  <div class="card-header">
                    <div class="dropdown float-right" data-display="static" >
                      <i class="fas fa-ellipsis-h" id="dropdownMenuLink" style="cursor: pointer;" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"></i>
                      
                    
                      <div class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownMenuLink">
                        <a class="dropdown-item post-update" id="post-update" data-toggle="modal" data-target="#modalUpdate" data-id="<%= post._id %>" style="cursor: pointer;">Chỉnh sửa bài viết</a>
                        <a class="dropdown-item post-delete" id="post-delete" data-toggle="modal" data-target="#confirm-delete-dialog" data-id="<%= post._id %>" style="cursor: pointer;">Xóa bài viết</a>
                      </div>
                    </div>
                  </div>
                  <!-- MODAL DELETE -->
                  <div class="modal fade" id="confirm-delete-dialog" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                    <div class="modal-dialog" role="document">
                      <div class="modal-content">
                        <div class="modal-header">
                          <h5 class="modal-title" id="del_postLabel">Xóa bài viết</h5>
                          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                          </button>
                        </div>
                        <div class="modal-body">
                          Bạn có chắc rằng muốn xóa bài viết này?
                        </div>
                        <div class="modal-footer">
                          <button type="button" class="btn btn-secondary" data-dismiss="modal">Hủy</button>
                          <button type="button" data-id="???" id="btn-delete-confirmed"data-dismiss="modal" class="btn btn-primary">Xóa</button>
                        </div>
                      </div>
                    </div>
                  </div>
                  <% } %>
                <!--Dropdown edit, delete-->
                <!--Update Modal-->
                <div class="modal fade" id="modalUpdate" tabindex="-1" role="dialog" aria-labelledby="PostUpdateModal">
                  <div class="modal-dialog" role="document">
                    <div class="modal-content">
                      <div class="modal-header">
                        <h5 class="modal-title" style="text-align: center; font-weight: bold; font-size: 30px;">Chỉnh sửa bài viết</h5>
                      </div>
                      <div class="modal-body">
                          <form>
                              <textarea name="updatecontent" id="updatecontent" style="border-radius: initial;border: none;outline: none;" class="form-control input-lg p-text-area tiny" rows="2" placeholder="Whats in your mind today?"></textarea>
                              <div class="modal-footer">
                                <button type="button" data-id="<%= post._id %>" data-dismiss="modal" id="update-confirmed" class="btn btn-primary update-confirmed">Chỉnh sửa bài viết</button>
                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Hủy</button>
                              </div>
                          </form>
                      </div>
                      
                    </div>
                  </div>
                </div>
                
                <!--Update Modal-->
                    <div class="card-body">
                      <h6 class="card-title" ><a href="/newfeed/timeline/<%- post.Owner %>"><%- post.Owner %> </a>
                          <p class="card-text"><small class="text-muted"><%= post.createAt %> </small></p>
                      </h6>
                      <input type="hidden" id="postId" value="<%= post._id %>">
                      <h6 class="card-subtitle mb-2 text-muted"></h6>
                      <p class="card-text" id="<%= post._id %>1311" style="overflow-y: auto;"><%- post.content %></p>
                        <div class="bg-white p-2">
                            <div class="d-flex flex-row fs-12">
                                <div class="like p-2 cursor action-collapse" data-toggle="collapse" aria-expanded="true" aria-controls="collapse-1<%= post._id %>" href="#collapse-1<%= post._id %>"><i class="far fa-comment"></i><span class="ml-1"  style="cursor: pointer;">Bình luận</span></div>
                            </div>
                        </div>	
                        <div id="collapse-1<%= post._id %>" class="bg-light p-2 collapse" data-parent="#myGroup">
                            
                         


                            <div class="input-group mb-3">
                              
                              <img class="rounded-circle" src="<%= user.avatar %>" width="52" >
                             
                              <input id="Comment" type="text" class="form-control"  placeholder="Nhập bình luận...">
                              <input type="hidden" id="input-comment" value="<%= post._id %>">
                              <div class="input-group-append">
                                <button class="btn btn-primary commentSubmit" id="commentsub">Gửi</button>
                              </div>
                            </div>
                            <br>
                            <ul id="<%= post._id %>ulul" class="fb-comments" style="width:100%;">
                                <% if (comments) {comments.reverse(), comments.forEach((comment) => { %>
                                    <% if(comment.PostId == post._id || user.role == 'admin') { %> 
                                        <li class="list-group-item mt-3" id="<%= comment._id %>">
                                            <h6 class="card-title" ><%= comment.Owner %> 
                                                <p class="card-text"><small class="text-muted"><%= comment.createAt %> </small></p>
                                            </h6>
                                            <h6 class="card-subtitle mb-2 text-muted"></h6>
                                            <p class="card-text" ><%= comment.content %> </p>
                                            <% if(user.name == comment.Owner) { %>
                                            <div class="card-footer text-muted" style="text-align: right;">
                                                <button type="button" id="commentdelete" data-id="<%= comment._id %>" class="btn btn-danger btn-sm commentdelete">Delete</button>
                                            </div>
                                            <% } %>
                                        </li>
                                    <% } %>
                                <% }) } %>
                            </ul>
                        </div>
                    </div>
                </div>
                <% }) } %>
            </div>

            
    
            <div class="col-sm-3 col-md-6 col-lg-4 p-3">
              <div class="card mt-3">
                <div class="card-body">
                  <h5 class="card-text text-center" id="date"></h5>
                  <a href="/newfeed/allNotif">
                    <p class="card-text text-right">Xem tất cả thông báo</p>
                </a>
                </div>
              </div>
                <% for (var l = notifs.length, i = 0; i < l; i++) { %>
                  <% notifs = notifs.reverse() %> 
                  <% notif = notifs[i] %> 
                  <% if(i < 5) { %> 
                <div class="card mt-3 bg-light">
                    <div class="card-body">
                      <p class="card-text"><small class="text-muted"><%= notif.falcuty %>  |  <%= notif.createAt %></small></p>

                      <h6 class="card-title" ><a href="/newfeed/allNotif/<%= notif._id %> "><%= notif.title %></a></h6>
                      
                      <p class="card-text text-truncate" ><%= notif.content %></p>                   
                    </div>
                </div>
                <% }else break %> 
                <% } %>
            </div>
        </div>
        
    </div>
  <script src="/javascripts/main.js"></script>
  </body>
</html>